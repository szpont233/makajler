<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>Imperium Lechitów - Forum</title>

<link rel="stylesheet" href="../../assets/css/xp.css" media="print" onload="this.media='all'">
<link rel="stylesheet" href="../../assets/css/style.css">
<link rel="icon" type="image/png" href="../../assets/favicon-96x96.png" sizes="96x96" />
<link rel="icon" type="image/svg+xml" href="../../assets/favicon.svg" />
<link rel="shortcut icon" href="../../assets/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="../../assets/apple-touch-icon.png" />
<link rel="manifest" href="../../assets/site.webmanifest" />
<meta name="theme-color" content="#fafafa" />
<link rel="mask-icon" href="../../assets/safari-pinned-tab.svg" color="#c0392b" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">


<style>
#form {
  background-color: #f0f4f8;
  border: 1px solid #999;
  padding: 20px;
  border-radius: 5px;
  width: 100%;
  max-width: 500px;
  margin: 20px auto;
  box-shadow: 0 0 10px rgba(0,0,0,0.1);
}

.field {
  margin-bottom: 15px;
}

.field label {
  display: block;
  font-size: 13px;
  font-weight: bold;
  color: #2b4a80;
  margin-bottom: 5px;
  font-family: Verdana, sans-serif;
}

.field input[type="text"],
.field textarea {
  width: 100%;
  padding: 8px;
  border: 1px solid #ccc;
  border-radius: 3px;
  font-family: Verdana, sans-serif;
  font-size: 13px;
  background-color: #fff;
  box-sizing: border-box;
}

.field textarea {
  min-height: 100px;
  resize: vertical;
}

input[type="submit"] {
  padding: 8px 16px;
  font-size: 14px;
  background-color: #2b4a80;
  color: white;
  border: 1px solid #1c3057;
  border-radius: 3px;
  cursor: pointer;
  font-weight: bold;
  font-family: Verdana, sans-serif;
  transition: background-color 0.2s ease-in-out;
}

input[type="submit"]:hover {
  background-color: #385d8a;
}
#content{
  background-color: #fafafa;
}

    #profreg{
        display: flex;
        justify-content: space-between;
        font-size: 11px;
    }
    #profil{
        padding-right: 15px;
    }
    #register{
        padding-left: 10px;
    }
.entry img {
    max-width: 300px;
    max-height: 200px;
    width: auto;
    height: auto;
    display: block;
    margin: 5px 0;
}
#submit-btn:disabled {
    background: #ccc;
    cursor: not-allowed;
}

#content{ 
    background-color: #fafafa;
    flex: 1; 
    }
#submit-btn:disabled{
     background: #ccc; 
     cursor: not-allowed; 
    }
    
#main{
    display: flex;
    align-items: flex-start;
    gap: 20px;
    padding: 15px; 
    }
#sidebar{ 
    width: 240px;
    flex-shrink: 0;
    }
#entries-list{
    font-family: 'Courier New';
    }

.entry-content {
    word-wrap: break-word;
    overflow-wrap: break-word;
    line-height: 1.5;
    margin: 0;
    padding: 0;
}

.entry-content.collapsed {
    overflow: hidden;
    max-height: 7.5em;
}

.entry-content.expanded {
    max-height: none;
}

/* Kontener na treść wpisu z ograniczeniem do 5 linii */
.entry-content {
    overflow: hidden;
    display: -webkit-box;
    -webkit-line-clamp: 5;
    -webkit-box-orient: vertical;
    word-wrap: break-word; /* Zapobiega wychodzeniu długich słów poza kontener */
    overflow-wrap: break-word;
    line-height: 1.5; /* Ustalona wysokość linii dla precyzyjnego ucinania */
    max-height: 7.5em; /* 5 linii * 1.5 line-height */
    transition: max-height 0.3s ease;
}

/* Klasa usuwająca limity po kliknięciu "Rozwiń" */
.entry-content.expanded {
    display: block;
    -webkit-line-clamp: unset;
    max-height: none;
}

/* Styl przycisku rozwijania */
.expand-btn {
    display: none; /* Domyślnie ukryty, pokazujemy go tylko gdy tekst jest za długi */
    background: #e1ecf4;
    color: #39739d;
    border: 1px solid #7aa7c7;
    border-radius: 3px;
    padding: 2px 8px;
    font-size: 11px;
    cursor: pointer;
    margin: 5px 0;
}

.expand-btn:hover {
    background: #cee0ed;
}

.expand-btn {
    display: none;
    background: #e1ecf4;
    color: #39739d;
    border: 1px solid #7aa7c7;
    border-radius: 3px;
    padding: 2px 8px;
    font-size: 11px;
    cursor: pointer;
    margin: 5px 0;
}

.expand-btn:hover {
    background: #cee0ed;
}

/* Styl paska narzędzi */
.toolbar button {
    background: #f0f0f0;
    border: 1px solid #777;
    border-radius: 2px;
    font-family: Verdana, sans-serif;
    font-size: 11px;
    cursor: pointer;
}

.toolbar button:hover {
    background: #fff;
    border-color: #000;
}

/* Żeby textarea nie miała zaokrąglonych rogów na górze, gdy styka się z toolbar */
#guest-content {
    border-top-left-radius: 0 !important;
    border-top-right-radius: 0 !important;
    border: 1px solid #999 !important;
}
    
@media(max-width: 900px) {
    #main { flex-direction: column; }
    #sidebar { width: 100%; }
}
</style>
</head>
<body>
<audio src="../../assets/witaj.mp3" hidden autoplay></audio> <!-- dzwiek wiadomosci z gadu gadu przy otwarciu strony-->
<script>
    document.addEventListener('click', function() {
    const audio = new Audio('../../assets/witaj.mp3');
    audio.play();
}, { once: true });
</script>

<div id="header">
    <a href="../../index.html" style="margin: auto; padding: 5px;"><div style="border: 1px solid black; padding: 5px; background-color: #c0c0c0;" ><img src="../../logo.png" alt="logo Lechii" ></div></a>
    <h1>Księga wpisów</h1>
    <p style="text-shadow: 2px 2px 3px black; color: black;">Napisz coś na tablice, i tak bedzie</p>
</div>

<div id="container">
    <div id="menu">
        <a href="../../index.html">Strona Główna</a> |
        <a href="../../container/projekty/index.html">Gry/Prodżekts</a> |
        <a href="../../container/galeria/index.html">Galeria</a> |
        <a href="../../container/kontakt/index.html">Kontakt</a> |
        <a href="../../container/swiatynia/index.html">Świątynia</a> |
        <a id="new" href="#">Księga wpisów</a>
    </div>

    <div id="logan">
        <p id="czyzal">Status...</p>
        <a id="profil" href="../../container/profile/index.html">Mój profil</a>
    </div>
    <div id="profreg">
        <a id="register" href="../../register.html">
            <img src="../../assets/icons/rejestruj.png" height="13" width="12" alt="*">
            Dołącz do Imperium
        </a>
        <a id="loginlink" href="../../login.html">
            Zaloguj się
            <img style="height:12px; width:12px; vertical-align:middle; margin-right:4px;" src="../../assets/icons/login.png">
        </a>
    </div>

<div id="main">
    <div id="content" style="max-width: 600px; margin: auto;">
        <h2>Księga Wpisów</h2>
        <p id="regulamin-tekst">
            Witaj na mini forum na mojej stronie. Nie biorę odpowiedzialności za brak zdolności do rozróżniania dobra i zła... Pozdrawiam :)
        </p>

        <form id="guestbook-form">
            <div style="background: #ffffcc; padding: 5px; border: 1px solid #ccc; margin-bottom: 10px;">
                <input type="checkbox" id="akceptuje-szponta" required>
                <label for="akceptuje-szponta" style="font-size: 11px;"> Przeczytałem, zrozumiałem i obiecuję godnie reprezentować Imperium</label>
            </div>

            <label style="font-weight: bold;">Kim jestem?</label><br>
            <input type="text" id="guest-name" name="name"><br><br>
            <label style="font-weight: bold;">Napisz na ściane</label><br>
            <div class="toolbar" style="background: #e1e1e1; border: 1px solid #999; border-bottom: none; padding: 4px; display: flex; gap: 5px; border-top-left-radius: 3px; border-top-right-radius: 3px;">
                <button type="button" onclick="wrapText('B')" title="Pogrubienie" style="font-weight: bold; width: 25px;">B</button>
                <button type="button" onclick="wrapText('P')" title="Akapit" style="width: 25px;">P</button>
                <button type="button" onclick="insertLink()" title="Wstaw link" style="color: blue; text-decoration: underline; cursor: pointer;">URL</button>
                <button type="button" onclick="insertImageTag()" title="Wstaw obrazek" style="cursor: pointer; display: flex; align-items: center; gap: 3px;">
                    <img src="../../assets/icons/image.png" alt="" style="width: 13px; height: 13px;"> IMG
                </button>
            </div>
            <textarea id="guest-content" maxlength="500" rows="4" cols="50" placeholder="Treść wpisu (max 500 znaków)" required ></textarea><br><br>
            <button type="submit" id="submit-btn" class="button" disabled>Dodaj wpis</button>
        </form>

        <hr>
        <div id="entries-list">Ładowanie wpisów... <br><progress></progress></div>
</div>
        <div id="sidebar">
            <div class="infobox" style="border: 2px solid red; background: #ffe6e6; min-height: auto;">
                <h3 style="color: red; margin-top: 0; font-size: 14px;">Centrum Naprawcze</h3>
                <p style="font-size: 10px; margin-bottom: 8px;">Strona wyglada jak rozjechane gówno?<br> Nie masz nowej aktualizacji?<br> Kliknij to aby poprawic!!</p>
                <button onclick="wyczyscDlaImperium()" style="width: 100%; background: red; color: white; border: 1px solid black; cursor: pointer; font-weight: bold; padding: 8px;">
                    AKTUALIZUJ STRONE
                </button>
                <script>

    function wyczyscDlaImperium() {
        localStorage.clear();
        const cookies = document.cookie.split(";");
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i];
            const eqPos = cookie.indexOf("=");
            const name = eqPos > -1 ? cookie.substr(0, eqPos) : cookie;
            document.cookie = name + "=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/";
        }
        location.reload(true);
    }
</script>
            </div>

    <script>
    const checkbox = document.getElementById('akceptuje-szponta');
    const submitBtn = document.getElementById('submit-btn');

    if (localStorage.getItem('regulamin_zaakceptowany') === 'true') {
        checkbox.checked = true;
        submitBtn.disabled = false;
    }

    checkbox.addEventListener('change', function() {
        if (this.checked) {
            submitBtn.disabled = false;
            localStorage.setItem('regulamin_zaakceptowany', 'true');
        } else {
            submitBtn.disabled = true;
            localStorage.removeItem('regulamin_zaakceptowany');
        }
    });
</script><br>
</div>



<script type="module">
import { auth, db } from '../../assets/firebase.js';
import { collection, addDoc, query, orderBy, onSnapshot, serverTimestamp, deleteDoc, doc, getDoc, updateDoc, increment, arrayUnion } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";
import { onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";

function formatDate(timestamp) {
    if (!timestamp) return "Teraz";
    const date = timestamp.toDate();
    return date.toLocaleString("pl-PL", {
        day: "2-digit",
        month: "2-digit",
        year: "numeric",
        hour: "2-digit",
        minute: "2-digit"
    });
}

function sanitizeHtml(str) {
    const temp = document.createElement('div');
    temp.innerHTML = str;
    const allowedTags = ['A', 'IMG', 'P', 'B', 'STRONG', 'BUTTON', 'BR'];

    function clean(node) {
        if (node.nodeType === 1) {
            if (!allowedTags.includes(node.tagName)) {
                const text = document.createTextNode(node.textContent);
                node.parentNode.replaceChild(text, node);
            } else {
                if (node.tagName === 'A') {
                    const href = node.getAttribute('href');
                    node.setAttribute('href', href || '#');
                    node.setAttribute('target','_blank');
                }
                if (node.tagName === 'IMG') {
                    const src = node.getAttribute('src');
                    node.setAttribute('src', src || '');
                    node.setAttribute('alt','');
                    node.setAttribute('loading','lazy');
                    node.removeAttribute('onerror');
                    node.style.maxWidth = '300px';
                    node.style.maxHeight = '200px';
                    node.style.width = 'auto';
                    node.style.height = 'auto';
                }
            }
        }
        Array.from(node.childNodes).forEach(clean);
    }

    Array.from(temp.childNodes).forEach(clean);
    return temp.innerHTML;
}
const q = query(collection(db, "guestbook"), orderBy("createdAt", "desc"))

function renderEntry(id, d) {
    const user = auth.currentUser;
    const uid = d.uid || "";
        const isGuest = d.guest === true;
    const badge = isGuest
    ? `<span style="color:#999;font-size:10px;">[GOŚĆ]</span>`
    : "";
    const canEdit = user && uid && (user.uid === uid || user.isAdmin);
    const authorName = d.nick || d.name || "Anonim";
    const profileLink = uid ? `../profile/index.html?uid=${uid}` : "#";
    const displayId = uid ? uid.substring(0,8) : "Niezarejestrowany";
    const score = d.score || 0;

    return `
    <div class="entry" id="entry-${id}" style="border-bottom:1px dotted #888; margin-bottom:15px; background: #fdfdfd; padding: 10px;">
        <div style="display: flex; justify-content: space-between;">
            <div>
                <a href="${profileLink}" style="color: #2b4a80; text-decoration: none; font-weight: bold;">${authorName}</a> 
                <span style="color: #444; font-size: 0.9em;">ID: ${displayId}</span>
                <small style="color:#666">(${formatDate(d.createdAt)})</small>
            </div>
            <div style="display: flex; align-items: center; gap: 5px; background: #eee; padding: 2px 8px; border-radius: 10px;">
                <button onclick="vote('${id}', 1)" style="cursor:pointer; border:none; background:none; font-weight:bold; color:green;">+</button>
                <span id="score-${id}" style="font-weight:bold; min-width: 20px; text-align:center;">${score}</span>
                <button onclick="vote('${id}', -1)" style="cursor:pointer; border:none; background:none; font-weight:bold; color:red;">-</button>
            </div>
        </div>
        
        <div id="content-${id}" class="entry-content" style="padding: 7px 2px 4px 2px;">
            ${sanitizeHtml(d.content)}
        </div>
        
        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 5px;">
            <div>
                <button class="expand-btn" id="btn-${id}" onclick="toggleExpand('${id}')">Pokaż więcej</button>
                <button onclick="showReplyForm('${id}')" style="font-size: 11px; cursor:pointer;">Odpowiedz</button>
                ${canEdit ? `<button onclick="deleteEntry('${id}')" style="font-size: 11px; cursor:pointer; color: brown;">Usuń</button>` : ""}
            </div>
        </div>

        <div id="reply-box-${id}" style="display:none; margin-top:10px; padding-left: 20px; border-left: 2px solid #ccc;">
            <textarea id="reply-input-${id}" placeholder="Napisz odpowiedź..." style="width:100%; font-size:12px;"></textarea>
            <button onclick="sendReply('${id}')" style="font-size:10px; margin-top:5px;">Wyślij odpowiedź</button>
        </div>

        <div id="replies-${id}" style="margin-left: 20px; font-size: 0.9em; color: #555;">
             ${d.replies ? d.replies.map(r => `
                <div style="margin-top:5px; border-top: 1px dashed #ccc; padding-top:2px;">
                    <strong>${r.nick}:</strong> ${sanitizeHtml(r.content)}
                </div>
             `).join('') : ''}
        </div>
    </div>`;
}

window.vote = async (entryId, change) => {
    const user = auth.currentUser;
    if (!user) { alert("Musisz być zalogowany, by oceniać!"); return; }

    const entryRef = doc(db, "guestbook", entryId);
    const entrySnap = await getDoc(entryRef);
    const data = entrySnap.data();

    // Sprawdzanie czy użytkownik już głosował
    if (data.voters && data.voters.includes(user.uid)) {
        alert("Już oddałeś głos na ten wpis!");
        return;
    }

    try {
        // 1. Zmień wynik wpisu i dodaj usera do listy głosujących
        await updateDoc(entryRef, {
            score: increment(change),
            voters: arrayUnion(user.uid)
        });

        // 2. Zaktualizuj punkty w profilu autora wpisu
        if (data.uid) {
            const authorRef = doc(db, "users", data.uid);
            await updateDoc(authorRef, {
                points: increment(change)
            });
        }
    } catch (e) {
        console.error(e);
    }
};

window.showReplyForm = (id) => {
    const box = document.getElementById(`reply-box-${id}`);
    box.style.display = box.style.display === 'none' ? 'block' : 'none';
};

window.sendReply = async (entryId) => {
    const user = auth.currentUser;
    const input = document.getElementById(`reply-input-${entryId}`);
    const content = input.value.trim();

    if (!user) return alert("Zaloguj się!");
    if (content.length < 2) return;

    const entryRef = doc(db, "guestbook", entryId);
    
    // Pobierz nick zalogowanego
    const userDoc = await getDoc(doc(db, "users", user.uid));
    const myNick = userDoc.exists() ? userDoc.data().nick : "Anon";

    await updateDoc(entryRef, {
        replies: arrayUnion({
            uid: user.uid,
            nick: myNick,
            content: content,
            createdAt: new Date()
        })
    });

    input.value = "";
    document.getElementById(`reply-box-${entryId}`).style.display = 'none';
};

window.toggleExpand = (id) => {
    const contentDiv = document.getElementById(`content-${id}`);
    const btn = document.getElementById(`btn-${id}`);
    
    if (contentDiv.classList.contains('expanded')) {
        contentDiv.classList.remove('expanded');
        btn.textContent = 'Pokaż więcej..';
    } else {
        contentDiv.classList.add('expanded');
        btn.textContent = 'Zwiń';
    }
};

// Zmodyfikowany onSnapshot, który sprawdza wysokość po każdym renderowaniu
onSnapshot(q, (snap) => {
    list.innerHTML = "";
    snap.forEach(doc => {
        const d = doc.data();
        list.innerHTML += renderEntry(doc.id, d);
    });

    // Czekamy chwilę na wyrenderowanie DOM, aby zmierzyć wysokości
    setTimeout(() => {
        snap.forEach(doc => {
            const id = doc.id;
            const contentDiv = document.getElementById(`content-${id}`);
            const btn = document.getElementById(`btn-${id}`);
            
            // Jeśli wysokość zawartości jest większa niż widoczny kontener, pokaż przycisk
            if (contentDiv && contentDiv.scrollHeight > contentDiv.offsetHeight + 2) {
                btn.style.display = 'inline-block';
            }
        });
    }, 100);
});

window.deleteEntry = async (id) => {
    if (!confirm("Usunąć wpis?")) return;
    await deleteDoc(doc(db, "guestbook", id));
};

const list = document.getElementById('entries-list');

// dodawanie wpisow formularz
const form = document.getElementById('guestbook-form');
const nameInput = document.getElementById('guest-name');

form.onsubmit = async (e) => {
  e.preventDefault();

  const content = document.getElementById('guest-content').value.trim();
  
  // Dodaj walidację maksymalnej długości
  if (content.length < 3 || content.length > 500) {
    alert("Treść wpisu musi mieć od 3 do 500 znaków.");
    return;
  }

  const user = auth.currentUser;

  try {
    if (!user) {
      // === GOŚĆ ===
      console.log("Tryb GOŚCIA - dodawanie wpisu...");
      const guestNick = document.getElementById('guest-name').value.trim() || "Anonim";
      const lastPost = Number(localStorage.getItem("last_guest_post") || 0);
      if (Date.now() - lastPost < 60000) {
        alert("Poczekaj minutę zanim dodasz kolejny wpis.");
        return;
      }
      localStorage.setItem("last_guest_post", Date.now());

      const guestData = {
        guest: true,
        uid: null,
        nick: guestNick,
        content: content,
        createdAt: serverTimestamp()
      };
      
      console.log("Dane gościa do wysłania:", guestData);
      await addDoc(collection(db, "guestbook"), guestData);
      console.log("✅ Wpis gościa dodany!");

    } else {
      // === ZALOGOWANY ===
      console.log("Tryb ZALOGOWANEGO - dodawanie wpisu...");
      console.log("User UID:", user.uid);
      
      const userDoc = await getDoc(doc(db, "users", user.uid));
      const nick = userDoc.exists() ? userDoc.data().nick : user.displayName || "Anonim";

      const userData = {
        guest: false,
        uid: user.uid,
        nick: nick,
        content: content,
        score: 0,
        voters: [],
        createdAt: serverTimestamp()
      };
      
      console.log("Dane zalogowanego do wysłania:", userData);
      await addDoc(collection(db, "guestbook"), userData);
      console.log("Wpis zalogowanego dodany!");

      console.log("Aktualizacja punktów użytkownika...");
      await updateDoc(doc(db, "users", user.uid), {
        points: increment(1)
      });
      console.log("Punkty zaktualizowane!");
    }

    form.reset();
    alert("Wpis dodany pomyślnie!");
    
  } catch (err) {
    console.error("BŁĄD SZCZEGÓŁOWY:", err);
    console.error("Kod błędu:", err.code);
    console.error("Wiadomość:", err.message);
    alert("Błąd: " + err.message);
  }
};

// --- ZMODYFIKOWANA OBSŁUGA STATUSU I NICKU ---

onAuthStateChanged(auth, async (user) => {
    const nameInput = document.getElementById('guest-name');
    const status = document.getElementById("czyzal");
    const link = document.getElementById("loginlink");

    if (user) {
        // SCENARIUSZ: UŻYTKOWNIK ZALOGOWANY
        let userNick = user.displayName || "Obywatel";
        
        // Opcjonalnie: pobierz świeży nick z bazy 'users' jeśli displayName jest pusty
        try {
            const userDoc = await getDoc(doc(db, "users", user.uid));
            if (userDoc.exists() && userDoc.data().nick) {
                userNick = userDoc.data().nick;
            }
        } catch (e) { console.error("Błąd pobierania nicku:", e); }

        nameInput.value = userNick;
        nameInput.disabled = true; // Zablokowane, bo ma konto
        nameInput.style.backgroundColor = "#e9ecef"; // Wizualne potwierdzenie blokady
        
        status.textContent = "Zalogowany jako: " + userNick;
        link.innerHTML = 'Wyloguj <img src="../../assets/icons/logout.png" alt="*" style="height:12px; width:12px; vertical-align:middle; margin-right:4px;">';
        link.onclick = (e) => { e.preventDefault(); signOut(auth); };
    } else {
        // SCENARIUSZ: GOŚĆ
        nameInput.value = ""; 
        nameInput.disabled = false; // GOŚĆ MOŻE WPISAĆ NICK
        nameInput.placeholder = "Wpisz swój nick (Gość)...";
        nameInput.style.backgroundColor = "#fff";
        
        status.textContent = "Nie jesteś zalogowany (tryb gościa)";
        link.innerHTML = 'Zaloguj się <img style="height:12px; width:12px; vertical-align:middle; margin-right:4px;" src="../../assets/icons/login.png">';
        link.href = "../../login.html";
        link.onclick = null; // Resetujemy akcję wylogowania
    }
});
</script>
</div>
</div>

<div class="footer">
    
    Strona stworzona przez obywateli Imperium Lechitów.
    <p style="text-align:center;">
    Odwiedzilo nas: <script type="text/javascript" src="https://counter.websiteout.com/js/21/0/0/0"></script> osob.
</p>

</div>

<script type="module" src="../../assets/firebase.js"></script>
<script>
    window.wrapText = (tag) => {
        const textarea = document.getElementById('guest-content');
        const start = textarea.selectionStart;
        const end = textarea.selectionEnd;
        const selectedText = textarea.value.substring(start, end);
        const replacement = `<${tag}>${selectedText}</${tag}>`;
        
        textarea.value = textarea.value.substring(0, start) + replacement + textarea.value.substring(end);
        textarea.focus();
        const pos = selectedText ? start + replacement.length : start + tag.length + 2;
        textarea.setSelectionRange(pos, pos);
    };

    window.insertLink = () => {
        const url = prompt("Podaj adres URL (np. https://google.com):", "https://");
        if (url) {
            const textarea = document.getElementById('guest-content');
            const start = textarea.selectionStart;
            const text = `<a href="${url}">Link</a>`;
            textarea.value = textarea.value.substring(0, start) + text + textarea.value.substring(textarea.selectionEnd);
            textarea.focus();
        }
    };

    window.insertImageTag = () => {
        const textarea = document.getElementById('guest-content');
        const start = textarea.selectionStart;
        const imgTag = '<img src="">';
        textarea.value = textarea.value.substring(0, start) + imgTag + textarea.value.substring(textarea.selectionEnd);
        textarea.focus();
        const cursorFallback = start + 10;
        textarea.setSelectionRange(cursorFallback, cursorFallback);
    };
</script>
</body>
</html>
