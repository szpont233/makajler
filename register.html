<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>Imperium Lechitów - Rejestracja</title>
<link rel="stylesheet" href="assets/css/xp.css" media="print" onload="this.media='all'">
<link rel="stylesheet" href="assets/css/style.css">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
form#auth-form{
  max-width: 400px;
  margin: 20px auto;
  background: linear-gradient(to bottom, #f0f4f8, #d9e0f2);
  padding: 20px;
  border: 1px solid #888;
  border-radius: 6px;
  box-shadow: 2px 2px 5px rgba(0,0,0,0.2);
}

form#auth-form h2{
  text-align: center;
  color: #2b4a80;
  margin-bottom: 15px;
}

form#auth-form label{
  display: block;
  margin: 10px 0 5px;
  font-weight: bold;
}

form#auth-form input{
  width: 100%;
  padding: 8px;
  border: 1px solid #888;
  border-radius: 3px;
  margin-bottom: 10px;
  font-size: 14px;
}

form#auth-form button{
  width: 100%;
  padding: 10px;
  background: linear-gradient(to bottom, #4f81bd, #385d8a);
  color: white;
  border: none;
  border-radius: 3px;
  font-weight: bold;
  cursor: pointer;
}

form#auth-form button:hover{
  background: #5a8fd1;
  box-shadow: 0 0 5px rgba(0,0,0,0.2);
}

#signup-status{
  text-align: center;
  margin-top: 10px;
  font-size: 14px;
}

.form-links{
  text-align: center;
  margin-top: 8px;
  font-size: 12px;
}

.form-links a{
  margin: 0 5px;
  color: #0033cc;
  text-decoration: underline;
}

.form-links a:hover{
  color: #cc0000;
}

@media(max-width:600px){
  form#auth-form {
    width: 90%;
    padding: 15px;
  }
  form#auth-form button {
    font-size: 16px;
  }
}
</style>
</head>
<body>

<div id="header">
  <a href="../../index.html" style="margin: auto; display:block; padding: 5px;">
    <div style="border: 1px solid black; padding: 5px; background-color: #c0c0c0;">
      <img src="../../logo.png" alt="logo Lechii" style="max-width:100%;">
    </div>
    
  </a>
  <h1>Logowanie / Rejestracja</h1>
  <p style="text-shadow: 2px 2px 3px black; color: black;">Dołącz do nas</p>
</div>


<div id="container">
    <div id="menu">
        <a href="index.html">Strona główna</a> |
        <a href="container/projekty/index.html">Gry/Prodżekts</a> | 
        <a href="container/galeria/index.html">Galeria</a> |
        <a href="container/kontakt/index.html">Kontakt</a> |
        <a href="container/swiatynia/index.html">Świątynia</a> |
        <a id="cwel" href="container/guestbook/index.html">Księga wpisów</a>
    </div>

  <form id="auth-form">
    <h2>Zarejestruj się</h2>
    <label for="email">Email:</label>
    <input type="email" name="email" id="email" required><br>
    <label for="name">Nazwa:</label>
    <input type="text" name="name" id="name" required><br>
    <label for="password">Hasło:</label>
    <input type="password" name="password" id="password" required><br>
    <input type="checkbox" name="zgoda" id="zgoda" required><span for="zgoda">Czy oddasz życie za IzraelaGPT i Benjamina Netanjahu?</span><br><br>
    <button type="submit">Załóż konto</button><br><br>
    <a href="login.html">Ale ja się chcialem zalogować</a>
    <div id="signup-status"></div>
  </form>

</div>

<div class="footer">
  Strona stworzona przez obywateli Imperium Lechitów.
</div>

<script type="module">
  // 1. Importujemy dodatkowe funkcje z Firestore
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
  import { getAuth, createUserWithEmailAndPassword, updateProfile } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";
  import { getFirestore, doc, setDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyB4_yXWVorjyQHf5OMIoXTUpfcyy7sJPyE",
    authDomain: "guestbook-imperium.firebaseapp.com",
    projectId: "guestbook-imperium",
    storageBucket: "guestbook-imperium.firebasestorage.app",
    messagingSenderId: "780071024560",
    appId: "1:780071024560:web:3ff011266cd83f7bd60875",
    measurementId: "G-665V4Q0410"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app); // Inicjalizacja bazy danych

  const form = document.getElementById("auth-form");
  const status = document.getElementById("signup-status");

  form.addEventListener("submit", async (e) => {
    e.preventDefault();

    const email = form.email.value;
    const name = form.name.value;
    const password = form.password.value;

    status.textContent = "Trwa tworzenie obywatela...";
    status.style.color = "black";

    try {
      // 1. Tworzenie konta w Auth (Email/Hasło)
      const userCredential = await createUserWithEmailAndPassword(auth, email, password);
      const user = userCredential.user;

      // 2. Aktualizacja profilu Auth (DisplayName - przydatne jako backup)
      await updateProfile(user, {
        displayName: name
      });
      const generateRandomColor = () => {
      const colors = ['#2b4a80', '#c0392b', '#16a085', '#27ae60', '#f39c12', '#8e44ad'];
      return colors[Math.floor(Math.random() * colors.length)];
  };

      // 3. TWORZENIE PROFILU W FIRESTORE (Kluczowy moment!)
      // Używamy setDoc i wskazujemy ID dokumentu takie samo jak UID użytkownika
      await setDoc(doc(db, "users", user.uid), {
        nick: name,
        email: email,          // Opcjonalnie, przydatne dla admina
        avatarColor: userColor,
        bio: "Obywatel Imperium Lechitów", // Domyślny opis
        rank: "Chłop",         // Ranga startowa
        points: 0,             // Punkty startowe
        createdAt: serverTimestamp()
      });

// Podczas rejestracji w bloku try:
const userColor = generateRandomColor();
// Zapisz to w Firestore (zakładając, że masz kolekcję 'users')
await setDoc(doc(db, "users", user.uid), {
    uid: user.uid,
    nick: name,
    avatarColor: userColor // Tutaj zapisujemy wylosowany kolor
});

      status.style.color = "green";
      status.textContent = `Witaj w Imperium, ${name}! Profil utworzony. Przekierowanie...`;

      form.reset();
      setTimeout(() => window.location.href = "login.html", 2000);

    } catch (error) {
      console.error("Błąd rejestracji:", error);
      status.textContent = `Błąd: ${error.message}`;
      status.style.color = "red";
    }
  });
</script>

</body>
</html>
